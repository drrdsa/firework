/* Base Styles */
body {
    margin: 0;
    overflow: hidden;
    background-color: #000;
    font-family: sans-serif;
}

canvas {
    display: block;
    background-color: #000;
    position: relative;
    z-index: 1;
}

/* --- Buttons positioned outside panels --- */
.mode-button { /* Top Right */
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 8px 15px;
    background-color: rgba(60, 100, 140, 0.8);
    color: white;
    border: 1px solid #587898;
    border-radius: 4px;
    cursor: pointer;
    z-index: 20;
    font-size: 0.9em;
    transition: background-color 0.2s ease;
}
.mode-button:hover {
    background-color: rgba(80, 120, 160, 0.9);
}

.main-panel-toggle { /* Top Left */
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 20;
    padding: 4px 6px;
    background-color: rgba(80, 80, 80, 0.8);
    color: #eee;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.2em;
    line-height: 1;
    transition: background-color 0.2s ease;
}
.main-panel-toggle:hover {
    background-color: rgba(100, 100, 100, 0.9);
}

#togglePresetBar { /* Bottom Right */
    position: fixed; /* Use fixed to stay relative to viewport */
    bottom: 10px;
    right: 10px;
    z-index: 16; /* Above preset bar */
    background-color: rgba(80, 80, 80, 0.7);
    color: #eee;
    border: 1px solid #555;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    padding: 0;
    font-size: 1.1em;
    line-height: 28px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
}
#togglePresetBar:hover {
    background-color: rgba(100, 100, 100, 0.9);
}
#togglePresetBar:active {
     transform: scale(0.95);
}


/* --- Main Panel Styling (Settings & Planner Containers) --- */
.mode-panel {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10; /* Below buttons, above canvas */
    transition: opacity 0.3s ease, visibility 0.3s ease;
    background-color: rgba(40, 40, 40, 0.85); /* Default background */
    color: #eee;
    padding: 15px;
    border-radius: 5px;
    max-width: 380px;
    border: 1px solid #444;
    max-height: calc(90vh - 20px); /* Adjust max height based on viewport */
    overflow-y: auto;
    padding-top: 45px; /* Space for the toggle button */
}

.planner-mode { /* Specific overrides for planner */
    background-color: rgba(45, 55, 65, 0.9);
    border: 1px solid #4a5a6a;
    /* padding-top: 45px !important; Is inherited correctly now */
}

/* Hiding class for Mode Switching */
.mode-panel.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

/* Hiding class for Manual Toggle Button */
#settingsContainer.hidden-by-toggle,
#plannerContainer.hidden-by-toggle {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

/* --- Inner Controls Styling (#controls div) --- */
#controls {
    /* No position needed */
    transition: max-height 0.5s ease-out, opacity 0.5s ease-out; /* Only for advanced toggle */
}

/* Hiding for the Advanced Settings section inside #controls */
#controls #advancedControls.hidden {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
    border-width: 0;
    overflow: hidden;
    margin-top: 0;
    margin-bottom: 0;
}

/* --- Headings --- */
#controls h2, #plannerContainer h2 {
    margin-top: 0; /* Reset margin now that padding handles space */
    margin-bottom: 15px;
    text-align: center;
    font-size: 1.2em;
    color: #fff;
}
#controls h3, #plannerContainer h3 {
    margin-top: 15px;
    margin-bottom: 10px;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
    font-size: 1em;
    color: #ddd;
}
#controls h3:first-of-type { /* Keep this */
    margin-top: 0;
}

/* --- Control Groups (Sliders, Checkboxes etc.) --- */
.control-group {
    margin-bottom: 12px;
}
.control-group label {
    display: block;
    margin-bottom: 4px;
    font-size: 0.9em;
    color: #ccc;
}
.control-group input[type="range"] {
    width: calc(100% - 55px);
    vertical-align: middle;
    cursor: pointer;
}
.control-group span:not(.hue-preview) {
    display: inline-block;
    width: 45px;
    text-align: right;
    vertical-align: middle;
    font-family: monospace;
    font-size: 0.9em;
    margin-left: 5px;
    color: #fff;
}
.checkbox-group label,
.checkbox-group-multi label {
    display: inline-block;
    margin-left: 5px;
    margin-right: 10px;
    vertical-align: middle;
    font-size: 0.9em;
    cursor: pointer;
    color: #ccc;
}
.checkbox-group input[type="checkbox"],
.checkbox-group-multi input[type="checkbox"] {
     vertical-align: middle;
     cursor: pointer;
}
.checkbox-group-multi {
    padding-top: 3px;
}

/* Toggle Advanced Button */
#toggleAdvancedButton {
    display: block;
    width: 100%;
    padding: 6px;
    margin-top: 15px;
    margin-bottom: 10px;
    background-color: #4a6a8a;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background-color 0.2s ease;
}
#toggleAdvancedButton:hover {
    background-color: #5a7aa0;
}

/* Clear Button */
#clearButton {
    display: block;
    width: 100%;
    padding: 8px;
    margin-top: 15px;
    background-color: #d9534f;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}
#clearButton:hover {
    background-color: #c9302c;
}

/* Info Text */
#controls p, #plannerContainer p {
    margin-top: 15px;
    font-size: 0.8em;
    color: #aaa;
    text-align: center;
}

/* --- Planner Specific Styles --- */
#showStepsContainer {
    margin-bottom: 20px;
    max-height: 200px;
    overflow-y: auto;
    background-color: rgba(0, 0, 0, 0.2);
    border: 1px solid #556;
    padding: 10px;
    border-radius: 4px;
}
#showStepsList { list-style: none; padding: 0; margin: 0; }
#showStepsList li {
    background-color: rgba(255, 255, 255, 0.05); margin-bottom: 5px; padding: 8px;
    border-radius: 3px; font-size: 0.85em; display: flex; justify-content: space-between;
    align-items: center; border: 1px solid transparent; cursor: pointer; transition: border-color 0.2s ease; color: #ddd;
}
#showStepsList li:hover { border-color: #aaa; }
#showStepsList li span.step-details { flex-grow: 1; margin-right: 10px; }
#showStepsList li span.step-color { display: inline-block; width: 15px; height: 15px; border-radius: 3px; margin-left: 5px; vertical-align: middle; border: 1px solid #888; }
#showStepsList li button.remove-step { background-color: #c9302c; color: white; border: none; border-radius: 3px; padding: 2px 5px; font-size: 0.8em; cursor: pointer; opacity: 0.7; transition: opacity 0.2s ease; }
#showStepsList li:hover button.remove-step { opacity: 1; }

#addStepForm, #showControls { background-color: rgba(0, 0, 0, 0.1); padding: 15px; border-radius: 4px; margin-top: 15px; border: 1px solid #556; }
.planner-group { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
.planner-group label { flex-basis: 120px; text-align: right; font-size: 0.9em; color: #ccc; }
.planner-group input[type="number"], .planner-group select, .planner-group input[type="range"] { flex-grow: 1; padding: 5px; border: 1px solid #778; background-color: #334; color: #eee; border-radius: 3px; font-size: 0.9em; max-width: 150px; }
.planner-group select { max-width: 162px; }
.planner-group select option { background-color: #334; color: #eee; }
.planner-group input[type="range"] { max-width: 110px; vertical-align: middle; }
.hue-preview { display: inline-block; width: 25px; height: 20px; border-radius: 3px; vertical-align: middle; margin-left: 5px; border: 1px solid #888; text-align: center; line-height: 20px; font-size: 0.8em; color: rgba(0,0,0,0.7); text-shadow: 0 0 2px white; }
#addStepButton { display: block; width: calc(100% - 20px); margin: 15px auto 5px auto; padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background-color 0.2s ease; }
#addStepButton:hover { background-color: #45a049; }
#showControls button { display: block; width: calc(100% - 20px); margin: 10px auto 5px auto; padding: 8px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s ease; }
#showControls button:hover { background-color: #0069d9; }
#clearSequenceButton { background-color: #f0ad4e; } #clearSequenceButton:hover { background-color: #ec971f; }
#saveShowButton { background-color: #5bc0de; } #saveShowButton:hover { background-color: #31b0d5; }
#loadShowButton { background-color: #5bc0de; } #loadShowButton:hover { background-color: #31b0d5; }
#playShowButton[disabled] { background-color: #aaa; cursor: not-allowed; }
.status-indicator { display: block; text-align: center; margin-top: 10px; font-size: 0.9em; color: #bbb; }

/* --- Preset Bar Styles --- */
#presetBar {
    position: fixed; /* Fixed position relative to viewport */
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: rgba(30, 30, 30, 0.85);
    padding: 8px 10px 12px 10px;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
    z-index: 15; /* Above canvas, below main panel toggle */
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;
    transform: translateY(0); /* Start visible */
    opacity: 1;
    box-sizing: border-box;
}

#presetBar.hidden {
    transform: translateY(100%); /* Slide down */
    opacity: 0;
    pointer-events: none;
}

#presetBar h3 {
    margin: 0 0 8px 0;
    font-size: 0.9em;
    color: #ccc;
    font-weight: normal;
    text-align: center;
    width: 100%;
}

#presetBar .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    width: 100%;
    max-width: 800px;
}

#presetBar .preset-button {
    padding: 5px 8px;
    font-size: 0.8em;
    flex-grow: 0;
    min-width: auto;
    background-color: #3a86ff; /* Distinct preset button color */
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
    text-align: center;
}
#presetBar .preset-button:hover {
     background-color: #005ef7;
}
#presetBar .preset-button:active {
     transform: scale(0.98);
}
/* --- Help Button & Modal Styles --- */

/* Container for top-right buttons */
.top-right-buttons {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 20;
    display: flex; /* Align buttons horizontally */
    gap: 8px;      /* Space between buttons */
}

/* Style for icon-like buttons */
.icon-button {
    padding: 4px 8px;
    background-color: rgba(80, 80, 80, 0.8);
    color: #eee;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.1em; /* Adjust size */
    line-height: 1;
    font-weight: bold;
    transition: background-color 0.2s ease;
}
.icon-button:hover {
    background-color: rgba(100, 100, 100, 0.9);
}

/* Specific adjustment for help button if needed */
#helpButton {
    /* Inherits .icon-button styles */
}

/* Modal Background */
.modal {
    display: none; /* Initially hidden */
    position: fixed; /* Stay in place */
    z-index: 50;     /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;     /* Full width */
    height: 100%;    /* Full height */
    overflow: auto;  /* Enable scroll if needed */
    background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
    /* Add fade in/out */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0s linear 0.3s;
}

.modal.visible {
    display: block; /* Or flex if using flex for centering */
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease;
}


/* Modal Content Box */
.modal-content {
    background-color: #282c34; /* Dark background */
    color: #ccc;             /* Light text */
    margin: 10% auto;       /* 10% from the top and centered */
    padding: 20px 30px 30px 30px;
    border: 1px solid #555;
    border-radius: 8px;
    width: 80%;              /* Could be more restrictive */
    max-width: 600px;         /* Maximum width */
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    position: relative; /* For positioning the close button */
    font-size: 0.95em;
    line-height: 1.6;
}

/* Close Button */
.modal-content .close-button {
    color: #aaa;
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    background: none;
    border: none;
    padding: 0;
    line-height: 1;
}

.modal-content .close-button:hover,
.modal-content .close-button:focus {
    color: #eee;
    text-decoration: none;
    cursor: pointer;
}

/* Modal Text Styling */
.modal-content h2 {
    margin-top: 0;
    color: #61dafb; /* Light blue accent */
    text-align: center;
    margin-bottom: 20px;
}

.modal-content p {
    margin-bottom: 15px;
}
.modal-content ul, .modal-content ol {
    margin-left: 20px;
    margin-bottom: 15px;
}
.modal-content li {
    margin-bottom: 8px;
}
.modal-content strong {
    color: #fff;
}
.modal-content code, .modal-content kbd, .modal-content samp {
    background-color: #3a3f4a;
    padding: 0.1em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
}
/* --- Toggle All Types Buttons --- */
.toggle-all-buttons {
    display: inline-block; /* Place next to the label */
    margin-left: 10px;     /* Space after the label */
    vertical-align: middle; /* Align with the label */
}

.small-button {
    padding: 1px 5px; /* Small padding */
    font-size: 0.75em; /* Smaller text */
    line-height: 1.4; /* Adjust line height */
    margin-left: 4px; /* Space between buttons */
    cursor: pointer;
    border-radius: 3px;
    border: 1px solid #778;
    background-color: #556;
    color: #ddd;
    transition: background-color 0.2s ease;
}

.small-button:hover {
    background-color: #667;
}

/* Adjust alignment with the main label if needed */
.control-group > label:first-of-type {
    vertical-align: middle; /* Might help alignment */
}
/* Style for the Finale Button */
#finaleButton, .finale-button { /* Use ID or add class .finale-button to the button */
    background-color: #ff4d4d; /* Bright Red */
    border: 1px outset #ff8080;
    font-weight: bold;
}

#finaleButton:hover, .finale-button:hover {
    background-color: #ff6666;
}

#finaleButton:active, .finale-button:active {
    background-color: #e60000;
    transform: scale(0.98);
}
/* --- Foldable Control Styles --- */
.foldable-control {
    /* Behaves like a control-group but allows nesting */
    margin-bottom: 12px;
}

.foldable-header {
    display: flex;       /* Align items horizontally */
    align-items: center; /* Center items vertically */
    margin-bottom: 5px;  /* Space before options */
}

.foldable-header input[type="checkbox"] {
     vertical-align: middle;
     margin-right: 5px; /* Space between checkbox and label */
     cursor: pointer;
}

.foldable-header label {
    flex-grow: 1; /* Label takes available space */
    margin-bottom: 0; /* Remove bottom margin from label */
    display: inline-block; /* Keep it inline */
    vertical-align: middle;
    cursor: pointer;
}

.fold-arrow {
    background: none;
    border: none;
    color: #aaa;
    font-size: 0.8em; /* Small arrow */
    padding: 0 5px;
    margin-left: 5px;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
}
.fold-arrow:hover {
    color: #eee;
}
.fold-arrow.open {
     transform: rotate(90deg); /* Point down when open */
}


.foldable-content {
    max-height: 0; /* Start hidden */
    overflow: hidden;
    transition: max-height 0.3s ease-out, padding 0.3s ease-out; /* Smooth transition */
    padding-left: 20px; /* Indent options slightly */
    padding-top: 0;
    padding-bottom: 0;
    border-left: 1px solid #444; /* Optional visual indicator */
    margin-left: 5px; /* Align with checkbox roughly */
}

.foldable-content.visible { /* Use .visible class to show */
    max-height: 200px; /* Adjust max-height to fit content */
    padding-top: 8px;
    padding-bottom: 5px;
}

/* Styling for nested control groups */
.foldable-content .sub-control {
    margin-bottom: 8px;
    display: flex; /* Align label and input */
    align-items: center;
    gap: 5px;
}
.foldable-content .sub-control label {
     flex-basis: 100px; /* Adjust label width */
     text-align: right;
     font-size: 0.85em;
     color: #bbb;
     margin-bottom: 0;
}
.foldable-content .sub-control input[type="range"] {
    width: calc(100% - 155px); /* Adjust width based on label/span */
}
.foldable-content .sub-control span {
    width: 40px; /* Adjust span width */
}
/* --- Speech Recognition UI Styles --- */

/* Make sure the container allows items side-by-side */
.top-right-buttons {
    /* display: flex; Should already have this */
    align-items: center; /* Align items vertically */
}

/* Style for the Mic button (uses existing .icon-button) */
#startSpeechButton {
    /* Add specific styles if needed, e.g., slightly different color */
    /* background-color: rgba(70, 100, 70, 0.8); */
}
#startSpeechButton:hover {
    /* background-color: rgba(90, 120, 90, 0.9); */
}

/* Style for the status indicator */
.speech-status-indicator {
    font-size: 0.8em;
    margin-left: 5px; /* Space after the mic button */
    padding: 3px 6px;
    background-color: rgba(50, 50, 50, 0.6);
    border-radius: 3px;
    color: #ccc;
    min-width: 60px; /* Give it some space */
    text-align: center;
    display: inline-block; /* Keep it inline */
    vertical-align: middle;
    transition: background-color 0.3s ease;
}

/* Optional: Style for when listening */
.speech-status-indicator.listening {
    background-color: rgba(200, 0, 0, 0.7); /* Red background when listening */
    color: white;
}